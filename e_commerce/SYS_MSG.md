# 概述

> 后台系统中，消息系统是一个必不可少的功能模块，其核心是帮助后台人员及时了解业务消息，保障业务正常运行。
> 系统内会开发大量的监控功能(可视化的报表和非可视化的报表)来对这些业务进行监控，同时通知相应的负责人以及时了解业务和服务器状况。

常见的一些监控功能:

* 账号异常(账号异地登录、账号多次密码输入错误)
* 运营通知(活动上架、活动下架)
* 订单异常（订单堆积、派单堆积）
* 服务器异常（服务器宕机、CPU过载）
* 脚本异常（脚本卡死、进程过多）

# 实现方式

## 直接触发

> `直接触发`是将消息发送的逻辑和具体的业务代码逻辑写在一起，当满足条件时，触发消息发送功能。

## 消息池

> 通过将所有消息先收集到一个消息池(如Mysql、Redis、Kafka等)中，然后再统一通过系统调度将消息发送给接收人。

* 优点：功能模块化，可以做到统一管理，代码的调用可以更简洁，后期维护成本可以降到最低。
* 缺点：消息会有延迟，消息池它是一个异步发送方式，消息的生产和发送是两个相互独立的过程；需要开发配置内容页面，开发量稍微大一点，但是后期能减轻更多的维护成本，我认为是非常值得的。

# 消息池模型

<img src="/assets/images/e_commerce/22.png"/>

模型主要分四层：

* `消息来源`: 消息来源从开发角度来说，也称为消息生产者，它主要是指消息的生成方式和位置。在庞大的后台系统中，技术架构会划分出多个业务模块，各自的的业务模块都由不同的开发人员维护，不同的业务组使用的语言也各不相同，所以在完成相同功能时，书写方式也是各不相同，这个是没有办法统一的。
* `消息池`: 主要作用是存储要发送内容信息，如消息内容，发送时间等。市面上常见的软件有 Mysql、Redis、Kafka、RabbitMQ 等。所以对消息数据的存储我们是可以做到统一的。
* `消息分发`: 主要作用是获取待发送的消息列表，并根据已设置的接收人信息，找到具体的接收人并发送消息。技术上通常会启动相应的任务程序持续的监控消息池，当消息池中有需要发送的数据，就执行相应业务逻辑。
* `接收人`: 具体的消息接收人，接收人的接收方式有手机、邮箱或站内信。

#功能分析

## 消息类型

在系统运行过程中，会涉及到许多业务功能的监控，如订单业务中，订单支付是否有未成功、订单分配是否有堆积的情况、派单功能是有堆积情况；再如运营业务中，商品运营活动已经设置上线时间，到点上线后需要及时通知运营人员上线是否成功，避免影响活动效果。

为了能够及时让维护人员了解问题，通常都对消息进行归类，如账号异常、服务器警告、数据库异常、运营通知、订单异常、脚本异常等。

## 紧急程度



[电商后台设计：系统消息](http://www.woshipm.com/pd/4061128.html)























